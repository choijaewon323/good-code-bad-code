# 7.5 데이터에 대해 진실의 원천을 하나만 가져야 한다

- 기본 데이터 : 코드에 제공해야할 데이터
- 파생 데이터 : 기본 데이터로 계산 가능한 데이터
- 은행계좌 예시 - 대변(credit), 차변(debit) (기본 데이터) / 계좌 잔액 : 대변 - 차변 (파생 데이터)

## 7.5.1 또 다른 진실의 원천은 유효하지 않은 상태를 초래할 수 있다

- 대변이 5달러이고 차변이 2달러인 상태에서 잔액이 10달러는 말이 안됨
  - 서로 일치하지 않는 두 진실의 원천 (기본 데이터 - 대변, 차변 / 파생 데이터 - 잔액) 


```java

UserAccount account = new Account(credit, debit, debit - credit); // 잔액이 차변에 대변을 빼는 방법으로 잘못 알고 계산한다.

```

## 7.5.2 해결책: 기본 데이터를 유일한 진실의 원천으로 사용하라

```java

class UserAccount {
    private final double credit;
    private final double debit;

    double getBalance() {
        return credit - debit;
    }
}

```

- 파생 데이터인 잔액에 대한 별도에 필드를 갖는건 중복

- 만약 계산에 시간이 많이 든다면? 지연 계산한 후 결과 캐싱하는 것이 좋음

```java

class UserAccount {
    private final ImmutableList<Transaction> transactions;

    private Double cachedCredit;
    private Double cachedDebit;

    Double getCredit() {
        if (cachedCredit == null) {
            cachedCredit = transactions.map(transaction -> transaction.getCredit())
            .sum();
        }

        return cachedCredit;
    }

    Double getDebit() {
        if (cachedDedit == null) {
            cachedDedit = transactions.map(transaction -> transaction.getDedit())
            .sum();
        }

        return cachedDedit;
    }

    Double getBalance() {
        return getCredit() - getDebit();
    }
}

```