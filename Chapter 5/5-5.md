## 5.5 깊이 중첩된 코드를 피하라

### 5.5.1 깊이 중첩된 코드는 읽기 어려울 수 있다

```java
	Address getOwnersAddress(Vehicle vehicle) {
		if (vehicle.hasBeenScraped()) {
			return SCRAPYARD_ADDRESS;
		} else {
			Purchase mostRecentPurchase = vehicle.getMostRecentPurchase();
			
			if (mostRecentPurchase == null) {
				return SHOWROOM_ADDRESS;
			} else {
				Buyer buyer = mostRecentPurchase.getBuyer();
				
				if (buyer != null) {
					return buyer.getAddress();
				}
			}
		}
		
		return null;
	}
```

- 약간 복잡함

### 5.5.2 해결책: 중첩을 최소화하기 위한 구조 변경

```java
	Address getOwnersAddress(Vehicle vehicle) {
		if (vehicle.hasBeenScraped()) {
			return SCRAPYARD_ADDRESS;
		}

		Purchase mostRecentPurchase = vehicle.getMostRecentPurchase();

		if (mostRecentPurchase == null) {
			return SHOWROOM_ADDRESS;
		}
		
		Buyer buyer = mostRecentPurchase.getBuyer();

		if (buyer != null) {
			return buyer.getAddress();
		}

		return null;
	}
```

- else 부분을 빼서 중첩이 빠지도록 재구성
- 위는 중첩된 모든 블록에 반환문이 있으므로 재구성이 쉬웠으나, 만약 중첩된 블록에 반환문이 없다면 함수가 너무 많은 일을 하고 있다는 신호

### 5.5.3 중첩은 너무 많은 일을 한 결과물이다

```java
	SentConfirmation sendOwnerALetter(Vehicle vehicle, Letter letter) {
		Address ownersAddress = null;
		
		if (vehicle.hasBeenScraped()) {
			ownersAddress = SCRAPYARD_ADDRESS;
		}

		Purchase mostRecentPurchase = vehicle.getMostRecentPurchase();

		if (mostRecentPurchase == null) {
			ownersAddress = SHOWROOM_ADDRESS;
		}

		Buyer buyer = mostRecentPurchase.getBuyer();

		if (buyer != null) {
			ownersAddress = buyer.getAddress();
		}

		return sendLetter(ownersAddress, letter);
	}
```

- 주소 찾는 로직 & 편지 보내는 로직이 하나의 함수에 포함됨

### 5.5.4 해결책: 더 작은 함수로 분리

```java
	SentConfirmation sendOwnerALetter(Vehicle vehicle, Letter letter) {
		Address ownersAddress = getOwnersAddress(vehicle);
		
		if (ownersAddress != null) {
			return sendLetter(ownersAddress, letter);
		}

		return null;
	}

	Address getOwnersAddress(Vehicle vehicle) {
		if (vehicle.hasBeenScraped()) {
			return SCRAPYARD_ADDRESS;
		}

		Purchase mostRecentPurchase = vehicle.getMostRecentPurchase();

		if (mostRecentPurchase == null) {
			return SHOWROOM_ADDRESS;
		}

		Buyer buyer = mostRecentPurchase.getBuyer();

		if (buyer == null) {
			return null;
		}
		return buyer.getAddress();
	}
```

- 가독성 및 책임 분리가 성공적으로 이루어짐